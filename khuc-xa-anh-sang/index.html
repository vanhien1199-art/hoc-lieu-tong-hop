<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i 5: Kh√∫c x·∫° √°nh s√°ng</title>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        // 1. ƒê·ªãnh nghƒ©a m√£ b√†i h·ªçc cho trang n√†y
        window.lessonId = 'khuc-xa-anh-sang';

        // 2. Logic c·ªßa Chatbot (nh√∫ng tr·ª±c ti·∫øp ƒë·ªÉ t·∫°o file duy nh·∫•t)
        document.addEventListener('DOMContentLoaded', () => {
            const chatWindow = document.getElementById('chat-window');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');

            // URL c·ªßa Web Service trung t√¢m
            const AI_SERVICE_URL = 'https://ai-trung-tam-service.onrender.com'; // Th·∫ßy/c√¥ gi·ªØ nguy√™n URL n√†y
            const LESSON_ID = window.lessonId || 'default';

            if(sendButton){
                sendButton.addEventListener('click', askAI);
                userInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        askAI();
                    }
                });
            }

            function addMessageToChat(text, className) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message', className);
                chatWindow.appendChild(messageElement);
                messageElement.innerHTML = marked.parse(text);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return messageElement;
            }

            async function askAI() {
                const question = userInput.value.trim();
                if (!question) return;
                addMessageToChat(question, 'user-message');
                userInput.value = '';
                const waitingMessage = addMessageToChat('Tr·ª£ l√Ω AI ƒëang suy nghƒ©...', 'ai-message');

                try {
                    const response = await fetch(`${AI_SERVICE_URL}/ask`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: question, lesson_id: LESSON_ID })
                    });
                    if (!response.ok) throw new Error('L·ªói m·∫°ng ho·∫∑c server');
                    const data = await response.json();
                    waitingMessage.innerHTML = marked.parse(data.answer);
                } catch (error) {
                    waitingMessage.innerHTML = marked.parse('**Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra!** Vui l√≤ng th·ª≠ l·∫°i sau.');
                }
            }
        });
    </script>

    <style>
        :root {
            --primary-color: #0277bd; /* Xanh d∆∞∆°ng c·ªßa n∆∞·ªõc */
            --secondary-color: #ffd600; /* V√†ng c·ªßa √°nh s√°ng */
            --bg-color: #f4f8fa;
            --card-bg-color: #ffffff;
            --text-color: #333;
            --correct-color: #2e7d32;
            --incorrect-color: #c62828;
        }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; background-color: var(--bg-color); color: var(--text-color); margin: 0; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        header { background-color: var(--primary-color); color: white; padding: 1.5rem 0; text-align: center; margin-bottom: 30px; }
        header h1 { margin: 0; }
        .card { background-color: var(--card-bg-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 25px; }
        h2, h3 { color: var(--primary-color); }
        h2 { border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; margin-top: 0; }
        button { background-color: var(--secondary-color); color: var(--text-color); border: none; padding: 10px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        button:hover { background-color: #ffca00; }
        
        /* Ph·∫ßn I: M√¥ ph·ªèng ƒë≈©a g√£y */
        .straw-sim-container {
            position: relative;
            width: 250px;
            height: 300px;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        .glass {
            width: 150px;
            height: 200px;
            background: linear-gradient(to top, #b3e5fc 0%, #b3e5fc 50%, transparent 50%, transparent 100%);
            border: 5px solid #a0a0a0;
            border-top: none;
            border-radius: 0 0 20px 20px;
        }
        .straw {
            position: absolute;
            width: 8px;
            height: 280px;
            background-color: #fdd835;
            transform-origin: bottom center;
            transform: rotate(20deg);
            bottom: 0px;
        }
        .straw-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: #fdd835;
            transform-origin: top center;
            transform: skewY(15deg);
            overflow: hidden;
        }
        
        /* Ph·∫ßn II: Th√≠ nghi·ªám PhET */
        .phet-container {
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }
        .phet-container iframe {
            display: block;
            border: none;
        }

        /* Ph·∫ßn III: Tr·∫Øc nghi·ªám */
        .quiz-option { margin-bottom: 10px; }
        .quiz-feedback { margin-top: 10px; font-style: italic; font-weight: bold; }
        .quiz-feedback.correct { color: var(--correct-color); }
        .quiz-feedback.incorrect { color: var(--incorrect-color); }

        /* CSS Chatbot */
        .chat-window { height: 300px; border: 1px solid #ccc; padding: 10px; overflow-y: auto; margin-bottom: 10px; border-radius: 5px; }
        .chat-message { margin-bottom: 10px; line-height: 1.4; }
        .user-message { text-align: right; }
        .ai-message { background-color: #f1f1f1; padding: 10px; border-radius: 8px; display: inline-block; max-width: 90%; text-align: left; }
        .chat-input-area { display: flex; gap: 10px; }
        .chat-input-area input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    </style>
</head>
<body>
    <header>
        <h1>B√†i 5: KH√öC X·∫† √ÅNH S√ÅNG</h1>
    </header>

    <div class="container">
        <section id="phan1" class="card">
            <h2>Ph·∫ßn I: M√¥ ph·ªèng Hi·ªán t∆∞·ª£ng Kh√∫c x·∫°</h2>
            <p>Ch·∫Øc h·∫≥n em ƒë√£ t·ª´ng th·∫•y m·ªôt chi·∫øc ƒë≈©a hay ·ªëng h√∫t tr√¥ng nh∆∞ b·ªã "g√£y" khi c·∫Øm v√†o c·ªëc n∆∞·ªõc. H√£y c√πng quan s√°t l·∫°i hi·ªán t∆∞·ª£ng th√∫ v·ªã n√†y qua m√¥ ph·ªèng d∆∞·ªõi ƒë√¢y.</p>
            <label for="straw-slider">K√©o thanh tr∆∞·ª£t ƒë·ªÉ nh√∫ng ƒë≈©a v√†o n∆∞·ªõc:</label>
            <input type="range" id="straw-slider" min="0" max="100" value="0" style="width: 100%;">
            <div class="straw-sim-container">
                <div class="glass"></div>
                <div class="straw" id="sim-straw">
                    <div class="straw-bottom"></div>
                </div>
            </div>
        </section>

        <section id="phan2" class="card">
            <h2>Ph·∫ßn II: Kh√°m ph√° v·ªõi Th√≠ nghi·ªám ·∫£o PhET</h2>
            <p>ƒê·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ ƒë·ªãnh lu·∫≠t kh√∫c x·∫°, em h√£y t∆∞∆°ng t√°c v·ªõi th√≠ nghi·ªám ·∫£o chuy√™n s√¢u t·ª´ PhET Colorado d∆∞·ªõi ƒë√¢y. H√£y th·ª≠ thay ƒë·ªïi g√≥c t·ªõi, m√¥i tr∆∞·ªùng v√† quan s√°t s·ª± thay ƒë·ªïi c·ªßa tia kh√∫c x·∫° nh√©!</p>
            <div class="phet-container">
                <iframe src="https://phet.colorado.edu/sims/html/bending-light/latest/bending-light_vi.html" width="100%" height="500px" allowfullscreen></iframe>
            </div>
        </section>

        <section id="ai-chatbot-card" class="card">
            <h3>ü§ñ Tr·ª£ l√Ω AI</h3>
            <p>B·∫°n c√≥ th·∫Øc m·∫Øc g√¨ v·ªÅ hi·ªán t∆∞·ª£ng kh√∫c x·∫° √°nh s√°ng kh√¥ng? H√£y h·ªèi t√¥i nh√©!</p>
            <div id="chat-window" class="chat-window">
                <div class="chat-message ai-message">Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ v·ªÅ b√†i h·ªçc n√†y?</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="user-input" placeholder="V√≠ d·ª•: Chi·∫øt su·∫•t l√† g√¨?">
                <button id="send-button">G·ª≠i</button>
            </div>
        </section>

        <section id="phan3" class="card">
            <h2>Ph·∫ßn III: Luy·ªán t·∫≠p nhanh</h2>
            <div id="quick-quiz">
                <div class="quiz-item">
                    <h4>C√¢u 1: Hi·ªán t∆∞·ª£ng kh√∫c x·∫° √°nh s√°ng l√† hi·ªán t∆∞·ª£ng tia s√°ng t·ªõi khi g·∫∑p m·∫∑t ph√¢n c√°ch gi·ªØa hai m√¥i tr∆∞·ªùng trong su·ªët th√¨...</h4>
                    <div class="quiz-option"><label><input type="radio" name="q1"> A. B·ªã h·∫Øt tr·ªü l·∫°i m√¥i tr∆∞·ªùng c≈©.</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q1" data-correct="true"> B. B·ªã g√£y kh√∫c t·∫°i m·∫∑t ph√¢n c√°ch v√† ti·∫øp t·ª•c ƒëi v√†o m√¥i tr∆∞·ªùng th·ª© hai.</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q1"> C. Truy·ªÅn th·∫≥ng kh√¥ng ƒë·ªïi h∆∞·ªõng.</label></div>
                    <div class="quiz-feedback" id="feedback-q1"></div>
                </div>
                <hr>
                <div class="quiz-item">
                    <h4>C√¢u 2: Khi chi·∫øu tia s√°ng t·ª´ kh√¥ng kh√≠ v√†o n∆∞·ªõc, g√≥c kh√∫c x·∫° (r) s·∫Ω...</h4>
                    <div class="quiz-option"><label><input type="radio" name="q2" data-correct="true"> A. Nh·ªè h∆°n g√≥c t·ªõi (i).</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q2"> B. L·ªõn h∆°n g√≥c t·ªõi (i).</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q2"> C. B·∫±ng g√≥c t·ªõi (i).</label></div>
                    <div class="quiz-feedback" id="feedback-q2"></div>
                </div>
                <hr>
                <div class="quiz-item">
                    <h4>C√¢u 3: Nguy√™n nh√¢n ch√≠nh g√¢y ra hi·ªán t∆∞·ª£ng kh√∫c x·∫° l√† do...</h4>
                    <div class="quiz-option"><label><input type="radio" name="q3"> A. √Ånh s√°ng b·ªã m·ªèi khi ƒëi ƒë∆∞·ªùng d√†i.</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q3"> B. M·∫∑t ph√¢n c√°ch kh√¥ng ph·∫≥ng tuy·ªát ƒë·ªëi.</label></div>
                    <div class="quiz-option"><label><input type="radio" name="q3" data-correct="true"> C. V·∫≠n t·ªëc √°nh s√°ng thay ƒë·ªïi khi truy·ªÅn t·ª´ m√¥i tr∆∞·ªùng n√†y sang m√¥i tr∆∞·ªùng kh√°c.</label></div>
                    <div class="quiz-feedback" id="feedback-q3"></div>
                </div>
            </div>
        </section>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- LOGIC CHO PH·∫¶N I: M√î PH·ªéNG ƒê≈®A G√ÉY ---
        const slider = document.getElementById('straw-slider');
        const straw = document.getElementById('sim-straw');
        slider.addEventListener('input', function() {
            // Gi√° tr·ªã slider t·ª´ 0 ƒë·∫øn 100
            const value = this.value; 
            // Chuy·ªÉn ƒë·ªïi th√†nh v·ªã tr√≠ 'bottom' t·ª´ -80px (b√™n ngo√†i) ƒë·∫øn 20px (b√™n trong)
            const bottomPosition = -80 + (value * 1); // 100/100 * 100 = 100. -80 + 100 = 20
            straw.style.bottom = `${bottomPosition}px`;
        });

        // --- LOGIC CHO PH·∫¶N III: TR·∫ÆC NGHI·ªÜM NHANH ---
        const quizRadios = document.querySelectorAll('#quick-quiz input[type="radio"]');
        quizRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const name = this.name;
                const feedbackEl = document.getElementById('feedback-' + name);
                
                if (this.dataset.correct) {
                    feedbackEl.textContent = "Ch√≠nh x√°c! R·∫•t t·ªët.";
                    feedbackEl.className = 'quiz-feedback correct';
                } else {
                    feedbackEl.textContent = "Ch∆∞a ƒë√∫ng. H√£y suy nghƒ© l·∫°i nh√©!";
                    feedbackEl.className = 'quiz-feedback incorrect';
                }
            });
        });
    });
    </script>
</body>
</html>